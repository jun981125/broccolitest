<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>장바구니 목록</title>
    <link rel="stylesheet" href="css/cart.css">
</head>

<body>
<th:block th:replace="common/header :: headerFragment"></th:block>
<main>
    <div id="sub_con">
        <div class="carttitle">
            <h2>장바구니<span class="material-symbols-outlined">shopping_cart</span></h2>
        </div>
        <form input type="checkbox">
            <div class="cartlist" th:each="cartItem, rowStat : ${cartItems}">
                <div class="product_img_box">
                    <a th:href="@{/showproduct}">
                        <img th:src="@{upload/}+${cartItem.product.pimage}"/>
                    </a>
                </div>
                <div class="product_text_box">
                    <p class="brd_name" th:text="${cartItem.product.brand}"></p>
                    <p class="prd_name" th:text="${cartItem.product.model}"></p>
                    <p class="product-price"
                       th:text="${#numbers.formatInteger(cartItem.product.price, 3, 'COMMA') + '원'}"></p>
                </div>
                <div class="adj_count">
                    <input type="number" th:value="${cartItem.cartCount}" th:min="1" name="orderCount"
                           class="order-count-input" data-cartitemid="${cartItem.cartItemId}"/>
                </div>
                <div class="total_price">
                    <input type="text" name="totalprice" class="total-price-output" readonly>
                </div>
            </div>
        </form>
        <button class="button gray" id="deleteproduct">삭제하기</button>
        <button class="button gray" id="payready" type="submit">주문하기</button>

        <div class="flex2">
            <form th:action="@{/clearCart}" method="post">
                <button class="button gray" type="submit">장바구니비우기</button>
            </form>
            <a href="index.html"><span class="material-symbols-outlined">house</span></a>
        </div>
    </div>
</main>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        var orderCountInputs = document.querySelectorAll(".order-count-input");
        var totalPriceOutputs = document.querySelectorAll(".total-price-output");
        var productPrices = document.querySelectorAll(".product-price");

        function updateTotalPrice() {
            for (var i = 0; i < orderCountInputs.length; i++) {
                var input = orderCountInputs[i];
                var totalPriceOutput = totalPriceOutputs[i];
                var cartCount = parseInt(input.value);
                var productPriceText = productPrices[i].textContent;
                var productPrice = parseFloat(productPriceText.replace(/[^0-9.-]+/g, ""));
                var total = cartCount * productPrice;
                totalPriceOutput.value = total.toLocaleString() + '원';
            }
        }

        // 초기 계산
        updateTotalPrice();

        orderCountInputs.forEach(function (input) {
            input.addEventListener("input", updateTotalPrice);
        });
    });
</script>

<th:block th:replace="common/footer :: footerFragment"></th:block>
</body>

</html>
